<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Intro k8s && CN</title>

		<!-- bootstrap -->
		<link rel="stylesheet" href="ext/bootstrap-4.1.3/css/bootstrap.css">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!-- remove annoying shadow around images -->
		<style>
			.reveal section img {
				background-color:white;
				border:0;
				box-shadow: 0 0 0 0;
			}
		</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h3>K<span style="text-transform: lowercase;">ubernetes i</span> C<span style="text-transform: lowercase;">loud</span>N<span style="text-transform: lowercase;">ative<br/>Introduction</span></h3>

					<img src="img/logo_kubernetes.svg" class="center-block" style="background-color:white;border:0;width: 30%"/>
					<!-- h5>+ how to prepare your service</h5 -->
					<br />

					<h6><small>W<span style="text-transform: lowercase;">ojciech</span> B<span style="text-transform: lowercase;">arczyński</span> - <a href="https://smacc.io" style="color:#3149a8">SMACC.<span style="text-transform: lowercase;">io</span></a> | <a href="https://hypatos.ai" style="color:#3149a8">H<span style="text-transform: lowercase;">ypatos.ai</span></a><br />
						27 M<span style="text-transform: lowercase;">arch</span> 2019</small>
				</section>

				<section>
					<h3>Wojciech Barczyński</h3>
					<div class="container">
						<div class="row">
							<div class='col-md-12'>
								<ul>
									<li>Software Developer &amp; System Engineer</li>
									<li>Now at Machine-Learning FinTech</li>
									<li>Since 2016 working with K8S</li>
								</ul>
							</div>
							<!-- div class='col-md-3'>
								<img style="padding:12px" src="img/hypatos/hypatos_logo_b.png" />
							</div-->
						</div>
						<div class="row d-flex flex-row justify-content-center align-items-center">
							<br />
							<br />
							<br />
							<p><small>G<span style="text-transform: lowercase;">ithub: </span><a href="https://github.com/wojciech12" style="color:#3149a8"><span style="text-transform: lowercase;">wojciech12</span></a>
								| Linked: <a href="https://www.linkedin.com/in/wojciechbarczynski/" style="color:#3149a8">IN</a>
								| HP<span style="text-transform: lowercase;">: </span><a href="http://wbarczynski.pl" style="color:#3149a8"><span style="text-transform: lowercase;">wbarczynski.pl</span></a>
								| T: <a href="https://twitter.com/wbarczynski" style="color:#3149a8"><span style="text-transform: lowercase;">@wbarczynski</span></a></small></p>
						</div>
					</div>
				</section>

				<!--
					Tell me a story
				-->
				<!-- section>
					<h3>Story</h3>
					<p>Kubernetes + Go + ...</p>
						<ul>
							<li><b>SMACC</b> - Fintech / ML - since 2017</li>
							<li><b>Lyke</b> - Mobile Fashion app - since 2016</li>
						</ul>
						<br />
					<p>I do not like Infra</p>

				</section -->

				<section data-background="img/hypatos_pitch/hypatos_pitch_1.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section data-background="img/intro/history_before_2016.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section>
					<h4>... - 2014</h4>
					<ul>
						<li>Everybody talks <i>services</i> but....</li>
						<li>No simple platform for operating services</li>
						<li>Mesosphere!</li>
						<li>Docker swarm not perfect</li>
						<li>We learn so much in Google (Borg) and other companies</li>
					</ul>
					<p><small>Docker like RoR change</small></p>
				</section>

				<section data-background="img/intro/history_new_linux_new_app_server.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section data-background="img/intro/history_cloudnative_foundation.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section data-background="img/intro/company_welcome.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section data-background="img/intro/my_experience.png" data-background-repeat="" data-background-size="100%">
				</section>


				<section data-background="img/intro/black_box.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section data-background="img/intro/lingua_franca.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section data-background="img/intro/learn_as_you_go.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section data-background="img/intro/app_way_smarter.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section>
					<h4>Kubernetes</h4>
					<ul>
						<li>Service oriented</li>
						<li>Battery for 12factor apps</li>
						<li>Orchiestration</li>
						<li>Focus on simplicity [*]</li>
					</ul>
					<p><small>[*] In spirit what Docker brought us</small></p>
				</section>
	
				<section>
					<h4>T<span style="text-transform: lowercase;">he twelve factor apps</span></h4>
					<ul>
						<li>Services to operate service, test, etc.</li>
						<li>Services with low TCO.</li>
						<li>Published by Heroku</li>
						<li>ps. No free lunch</li>
					</ul>
					<p><small><a href="https://12factor.net/">https://12factor.net</a></small></p>
				</section>

				<section>
					<h4>Kubernetes</h4>
					<img src="img/k8s_intro.svg" style="width:90%"/>
					<small><code>make docker_push; kubectl create -f app-srv-dpl.yaml</code></small>
				</section>

				<section>
					<h4>Scale up! Scale down!</h4>
					<img src="img/k8s_intro_scale_up.svg" style="width:90%"/>
					<small><code>kubectl --replicas=3 -f app-srv-dpl.yaml</code></small>
				</section>

				<section>
					<h4>Resilience!</h4>
					<img src="img/k8s_ha_resistance_2.svg" style="width:90%"/>
					<small><code>kubectl --replicas=3 -f app-srv-dpl.yaml</code></small>
				</section>

				<section>
					<h4>Resilience!</h4>
					<img src="img/k8s_ha_resistance_3.svg" style="width:90%"/>
					<small><code>kubectl --replicas=3 -f app-srv-dpl.yaml</code></small>
				</section>

				<section>
					<h4>Deployment and Pods</h4>
					<img src="img/backup_slides/k8s_deployment_and_pods.svg" style="width:80%"/>
				</section>

				<section>
					<h4><span style="text-transform: lowercase;">Deployment.yml</span></h4>

					<pre><code class="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: demo-api
  labels:
    app: demo-api
spec:
  replicas: 3
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: demo-api
  template:
    metadata:
      labels:
        app: demo-api
    spec:
      containers:
      - name: app
        image: wojciech11/api-status:1.0.0
        ports:
        - containerPort: 80</code></pre>
				</section>

				<section>
					<h4>Service and pods</h4>
					<img src="img/backup_slides/k8s_service_and_pods.svg" style="width:80%" />
					<p><small>Service matches pods based on labels</small></p>
				</section>

				<section>
					<h4><span style="text-transform: lowercase;">Service.yml</span></h4>

					<pre><code class="yaml">apiVersion: v1
kind: Service
metadata:
  name: demo-api
spec:
  ports:
  - port: 80
    protocol: TCP
  selector:
    app: demo-api
  type: LoadBalancer</code></pre>
				</section>

				<section>
					<h4>Service</h4>
					<code>curl http://users/list</code>

					<p><small>Load balanced inside cluster!</small></p>
				</section>

				<section>
					<h4>How get user requests?</h4>
						<img src="img/traefik_architecture.png" width="90%"/>
				</section>

				<section data-markdown>
					<script type="text/template">
### Ingress

<table>
	<thread>
		<tr>
			<th>Pattern</th><th>Target App Service</th>
		</tr>
	</thread>
	<tbody>
		<tr>
			<td>api.smacc.io/v1/users</td><td>users-v1</td>
		</tr>
		<tr>
			<td>api.smacc.io/v2/users</td><td>users-v2</td>
		</tr>
		<tr>
			<td>smacc.io</td><td>web</td>
		</tr>
	</tbody>
</table>
					</script>
				</section>

				<section>
					<h4>Basic Concepts</h4>
					<p><table>
						<thread>
							<tr>
								<th>Name</th><th>Purpose</th><th></th>
							</tr>
						</thread>
						<tbody>
							<tr>
								<td>Service</td><td>Interface</td><td>Entry point (Service Name)</td>
							</tr>
							<tr>
								<td>Deployment</td><td>Factory</td><td>How many pods, which pods</td>
							</tr>
							<tr>
								<td>Pod</td><td>Implementation</td><td>1+ docker running</td>
							</tr>
						</tbody>
					</table></p>
				</section>


				<section data-markdown>
					<script type="text/template">
#### Service Discovery<br />and Labeling

- names in DNS: <br /><code>curl http://users/list</code>
- labels:<br /><code>name=value</code>
- annotations: <br /><code>prometheus.io/scrape: "true"</code> 
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
#### Service Discovery

- auto-wiring with logging and monitoring
- drop-in installation (traefik, prometheus, ...)
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
#### Integration with Monitoring

<pre><code class="yaml">apiVersion: v1
kind: Service
metadata:
  name: iam
  labels:
    app: iam
    tier: backend
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/scheme: "http"
    prometheus.io/path: "metrics"
    prometheus.io/port: "8088"
</code></pre>
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
#### Ingress configuration

<pre><code class="yaml">apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: iam
  annotations:
    kubernetes.io/ingress.class: traefik
    traefik.frontend.rule.type: PathPrefixStrip
spec:
  rules:
  - host: example.org
    http:
      paths:
        - path: /iam
          backend:
            serviceName: iam
            servicePort: 80
</code></pre>
					</script>
				</section>


				<section data-markdown>
					<script type="text/template">
### A<span style="text-transform: lowercase;">ll hail the git!</span>

- Yaml
- integration:<br />monitoring, alarming, ingress-controller
- ...
- Devs can forget about infra... almost
- DevOps Culture Dream!

<p><small>+ all tools -&gt; CRD </small></p>
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
### <span style="text-transform: lowercase;">Simple semantic</span>


- Complex release strategies are (relatively) easy
- Continoues Deployment is simply to implement!

<p><small><a href="https://github.com/wojciech12/talk_zero_downtime_deployment_with_kubernetes">github.com/wojciech12/talk_zero_downtime_deployment_with_kubernetes</a></small></p>
					</script>
				</section>


				<section data-markdown>
					<script type="text/template">
<img src="img/cncf/cncf-color.svg" />
					</script>
				</section>	

				<section>
					<h4>Prometheus</h4>
					<img src="img/cncf/prometheus-horizontal-color.svg" width="60%" />
					<p><small>Best in class monitoring and alerting</small>
				</section>

				<section>
					<h4>Fluentd</h4>
					<img src="img/cncf/fluentd-stacked-color.svg" width="50%" />
					<p><small>combined with ElasticSearch and Kibana</small>
				</section>

				<section>
					<h4>Etcd</h4>
					Distributed key-value store.
					<img src="img/cncf/etcd-horizontal-color.svg" width="50%" />
					<p><small>Alternative: Consule, Zookeeper</small>
				</section>

				<section>
					<h4>Ingress/Proxy</h4>
					<img src="img/cncf/envoy-horizontal-color.svg" width="50%" />
					<p><small>other: Nginx, Traefik</small>
				</section>

				<section>
					<h4>Hottest!</h4>
					<img src="img/istioio-ar21.svg" width="50%" />
					<p><small>Not in CloudNative Foundation</small>
				</section>

				<section>
					<h4>Tracing</h4>
					<img src="img/cncf/jaeger-stacked-color.svg" width="35%" />
					<p><small>the last piece for observability, read <a href="https://peter.bourgon.org/go-for-industrial-programming/#observability">this blog</a></small>
				</section>

				<section>
					<h4>K8S Package manager</h4>
					<img src="img/cncf/helm-stacked-color.svg" width="30%" />
					<p><small>I do not recommend to use</small>
				</section>

				<section>
					<h4>Much more</h4>
					<ul>
						<li>Kubeless/OpenFaaS for Serverless</li>
						<li>Kubeflow/Pachyderm for Machine Learning</li>
						<li>VirtualMachines with K8S - kata, kubevirt</li>
					</ul>
				</section>

				<section>
					<h4>Common</h4>
					<ul>
						<li>Simple (reasonable) to run</li>
						<li>Focus on simplicity in operating at scale</li>
					</ul>
				</section>

				<section>
					<h4>How to start</h4>
				</section>

				<section>
					<h4>as-a-service</h4>
					<ul>
						<li>Google - GCE</li>
						<li>Azure - AKS</li>
						<li>Amazon - EKS</li>
					</ul>
					<p><small>A lot of installers as well. See also <a href="https://rancher.com/">rancher</a>.</small></p>
				</section>

				<section>
					<h4>At home</h4>
					<ul>
						<li>Mini-kube</li>
						<li>...</li>
					</ul>
					<p><small>A lot of installers as well</small></p>
				</section>

				<section data-background="img/cd_ci/Slide8.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section data-background="img/cd_ci/Slide12.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section data-background="img/cd_ci/Slide13.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section>
					<h3><span style="text-transform: lowercase;">and hide it!</span></h3>
					<p>your-platform.git</p>
					<ul>
						<li><code>git tag</code> and <code>push</code></li>
						<li>branches: dev, staging, master</li>
						<li>Generated k8s files</li>
						<li>PR to production</li>
					</ul>
					<p><small>Similar to the <a href="https://www.youtube.com/watch?v=kOa_llowQ1c">Kelsey Hightower approach</a></small></p>
				</section>

				<section>
					<h2>Kubernetes</h2>
					<ul>
						<li>Pure and generated<br />from simple templates with ${ENV_VAR}</li>
						<li>2x kubernetes operators</li>
					</ul>
				</section>

				<section data-markdown>
					<script type="text/template">
#### Git Repo

<pre><code>|- tools
|    |- kube-service.yaml
|    \- kube-deployment.yaml
|
|- Dockerfile
|- VERSION
\- Makefile</code></pre>
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
#### M<span style="text-transform: lowercase;">akefile</span>

<pre><code>SERVICE_NAME=v-connector
DOCKER_REGISTRY=eu.gcr.io

test: test_short test_integration

run_local:

release: docker_build docker_push

kube_create_config:

deploy:</code></pre>

<p><small>Copy&Paste from the project to project</small></p>
					</script>
				</section>

<!-- section>
<h3>Continuous Deployment</h3>
<ol>
	<li><code>git tag</code> and <code>push</code></li>
	<li>smacc-platform.git</li>
	<li>Deploy to the staging branch</li>
	<li>PR to production</li>
</ol>
</section -->

				<section data-background="img/cd_ci/Slide21.png" data-background-repeat="" data-background-size="100%">
				</section>

				<section data-background="img/cd_ci/Slide22.png" data-background-repeat="" 
				data-background-size="100%">
				</section>

<section>
<h3>K<span style="text-transform: lowercase;">ubernetes</span> vs S<span  style="text-transform: lowercase;">tartup</span></h3>
<ul>
	<li>VM with application run in dockers</li>
	<li>After MVP version X, go to k8s</li>
	<li>Learn as-you-go</li>
	<li>Do not get high on all CN projects :)</li>
</ul>
</section>

<!-- section>
<h3>E<span style="text-transform: lowercase;">ffective</span> K<span style="text-transform: lowercase;">ubernetes</span></h3>
<ul>
	<li>Start with small iterations</li>
	<li>Learn as-you-go</li>
	<li>Keep Kubernetes Understable</li>
</ul>
<p><b>Hope the k8s community keep it this way</b></p>
</section -->

<!-- section>
<h3>E<span style="text-transform: lowercase;">ffective</span> K<span style="text-transform: lowercase;">ubernetes</span></h3>
<ul>
	<li>Move configuration to runtime</li>
	<li>Do not terrorize your devs with K8S</li>
	<li>No free lunch... app must be smarter</li>
</ul>
</section -->

<!-- section data-background="img/smacc_header_IT_source.jpg" data-background-repeat="" data-background-size="100%" data-background-position="bottom"
			style="position: relative; top:0">
				<h4>B<span style="text-transform: lowercase;">ig thanks to my colleages in</span> L<span style="text-transform: lowercase;">yke and</span> SMACC</h4>
			</section -->

<section data-background="img/smacc_header_IT_source.jpg" data-background-repeat="" data-background-size="100%" data-background-position="bottom"
			style="position: relative; top:0">
				<h4>Thank you. Questions?</h4>
				<p><small><span style="text-transform: lowercase;">btw. <a href="https://github.com/hypatos/jobs">https://github.com/hypatos/jobs</a></small></p>
			</section>

			<section data-background="img/smacc_header_IT_source.jpg" data-background-repeat="" data-background-size="100%" data-background-position="bottom"
						style="position: relative; top:0">
							<h4><span style="text-transform: lowercase;">github.com/wojciech12</span></h4>
							<!-- p>ps. We are hiring.</p --><!-- Developers, Frontend, System Engineers -->
						</section>

						<section>
							<img src="img/hypatos/hypatos_logo_b.png" width="40%" />
							<img src="img/hypatos_hiring/logo_go.png" width="25%" />
							<img src="img/hypatos_hiring/logo_python.png" width="25%" />

							<img src="img/hypatos_hiring/logo_pytorch.png" width="20%" />
							<img src="img/hypatos_hiring/logo_tensorflow.png" width="25%" />
							<img src="img/hypatos_hiring/logo_kubernetes.svg" width="10%" />
							<img src="img/hypatos_hiring/logo_openapi.png" width="10%" />

							<img src="img/hypatos_hiring/logo_aws.png" width="20%" />
							<img src="img/hypatos_hiring/logo_prometheus.png" width="15%"/>
							<img src="img/hypatos_hiring/logo_azure.png" width="15%" />
							<img src="img/hypatos_hiring/logo_lambda.png" width="15%" />

							<img src="img/hypatos_hiring/smacc_lets_do_this.png" width="25%" />
						</section>

					<!--
						BACKUP SLIDES
					-->
				<section data-background="img/smacc_header_IT_source.jpg" data-background-repeat="" data-background-size="100%" data-background-position="bottom" style="position: relative; top:0">
					<h2>Backup Slides</h2>
				</section>

				<section data-markdown>
					<script type="text/template">
### Infra tools

- Prometheus + AlertMnager + Grafana
- Traefik
- Kafka - Yolean/kubernetes-kafka
- Vault on Etcd - banzaicloud/bank-vaults
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
### Data stores

- Kafka - Yolean/kubernetes-kafka
- Etcd - coreos/etcd-operator
- DB: PSQL and Mongo
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
### Backups: 

- old-school backups
- replications
					</script>
				</section>

				<section>
					<h1>Kubernetes Concepts+</h1>
				</section>

				<section>
				<h3>Pods</h3>
				<div class="container">
					<div class="row">
						<div class='col-md-6'>
							<ul>
								<li>See each other on localhost</li>
								<li>Live and die together</li>
								<li>Can expose multiple ports</li>
							</ul>
						</div>
						<div class='col-md-5'>
							<img src="img/backup_slides/k8s_pod.svg" style="width:90%" />
						</div>
					</div>
				</div>
				</section>

				<section>
					<h3>Side-cars</h3>
					<img src="img/backup_slides/k8s_pod_2.svg" style="width:90%" />
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
